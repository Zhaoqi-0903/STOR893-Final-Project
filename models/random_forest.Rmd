---
title: "Random Forest"
author: "ximing"
date: "5/5/2021"
output:
  html_document: default
  pdf_document: default
---
```{r}
library(glmnet)
library(randomForest)
library(caret)
library(rpart)
```

# Load Data
```{r setup, include=FALSE}
load("../Data/oversampling_train_and_unchanged_test.RData")
```

# Define Random Forest Model
```{r}
rf.fit = function(index_trait, feature = "all"){
  if(feature == "fc"){ 
    df.rf = cbind(df[,c(2:61)], df[,121+index_trait])
  }else if(feature == "sc"){
    df.rf = cbind(df[,c(62:121)], df[,121+index_trait])
  }else{
    df.rf = cbind(df[,c(2:121)], df[,121+index_trait])
  }

  colnames(df.rf)[dim(df.rf)[2]] = "Depressive_Ep"
  df.rf = na.omit(df.rf)
  

  index = sample(c(1:dim(df.rf)[1]), round(dim(df.rf)[1]/3))

  df_train = df.rf[-index,]
  df_test = df.rf[index,]
  


  
 
  
 
  
  if(feature == "fc"){
   rf_classifier = randomForest(Depressive_Ep ~ FCfeature_1+FCfeature_2+FCfeature_3+FCfeature_4,data=df_train, ntree=100, mtry=2, importance=TRUE)
    summary(rf_classifier)
    rf.pred = predict(rf_classifier, df_test[,c(1:4)])
  }else if(feature == "sc"){
     rf_classifier = randomForest(Depressive_Ep~SCfeature_1+SCfeature_2+SCfeature_3, data = df_train, ntree=100, mtry=2, importance=TRUE)
    summary(rf_classifier)
    rf.pred = predict(rf_classifier, df_test[,c(1:3)])
  }else{
     df_train=cbind(df_train[,c(2:31)],df_train[,c(62:91)],df_train[,length(df_train)])
      colnames(df_train)[dim(df_train)[2]] = "Depressive_Ep"
     rf_classifier = randomForest(Depressive_Ep~., data = df_train, ntree=500,  mtry=2,importance=TRUE)
     
    summary(rf_classifier)
    test_data=cbind(df_test[,c(2:31)],df_test[,c(62:91)])
    
    
    print(dim(test_data)) #343  60
    rf.pred = predict(rf_classifier, data =test_data )
    print(length(rf.pred))#685
  }

  
    #mse = mean((rf.pred - df_test$Depressive_Ep)^2)
    
   # return(list(mod = rf_classifier, mse = mse))

  
  
  
  
    
   
}
```
```{r}
rf.fit(131, feature = "all")
```

```{r}
rf.fit(131, feature = "sc")
```
```{r}
rf.fit(131, feature = "fc")
```

```{r}

train_oversampling[,length(train_oversampling)]
```

```{r}
dt.fit = function(index_trait=130, feature = "all"){
  if(feature == "fc"){ 
    df_train = cbind(train_oversampling[,c(2:61)], train_oversampling[,length(train_oversampling)])
    
    df_test = cbind(testset[,c(2:61)], testset[,length(testset)])
  }else if(feature == "sc"){
    df_train = cbind(train_oversampling[,c(62:121)], train_oversampling[,length(train_oversampling)])
    
      df_test = cbind(testset[,c(62:121)], testset[,length(testset)])
  }else{
   df_train = cbind(train_oversampling[,c(2:121)], train_oversampling[,length(train_oversampling)])
   
     df_test = cbind(testset[,c(2:121)], testset[,length(testset)])
  }

  colnames(df_train)[dim(df_train)[2]] = "Depressive_Ep"
   colnames(df_test)[dim(df_test)[2]] = "Depressive_Ep"
  df_test = na.omit(df_test)
  

  
  
  if(feature == "fc"){
  
    decision_tree=rpart(
  Depressive_Ep ~ FCfeature_1+FCfeature_2+FCfeature_3, 
  data = df_train,method="class")
    summary( decision_tree)
    dt.pred = predict(decision_tree, df_test[,c(1:3)])
  }else if(feature == "sc"){
     decision_tree = rpart(as.factor(Depressive_Ep)~SCfeature_1+SCfeature_2+SCfeature_3, data = df_train, method="class")
    summary(rf_classifier)
   dt.pred = predict(decision_tree, df_test[,c(1:3)])
  }else{
     decision_tree = randomForest(as.factor(Depressive_Ep)~FCfeature_1+FCfeature_2+FCfeature_3+SCfeature_1+SCfeature_2+SCfeature_3, data = df_train, method="class")
    summary(decision_tree)
    dt.pred = predict(decision_tree, df_test[,c(1:3, 61:63)])
  }
   

  
   
    accuracy = sum((dt.pred==df_test$Depressive_Ep))/length(dt.pred)
    recall=
    
    return(list(mod = decision_tree,accuracy=accuracy))
  
    
   
}
```

```{r}
dt.fit(130, feature = "all")
```



