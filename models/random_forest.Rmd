---
title: "Random Forest"
author: "ximing"
date: "5/5/2021"
output:
  html_document: default
  pdf_document: default
---
```{r}
library(glmnet)
library(randomForest)
library(caret)
library(rpart)
```

# Load Data
```{r setup, include=FALSE}
load("../Data/merge_df.RData")
```

# Define Random Forest Model
```{r}
rf.fit = function(index_trait, feature = "all"){
  if(feature == "fc"){ 
    df.rf = cbind(df[,c(2:61)], df[,121+index_trait])
  }else if(feature == "sc"){
    df.rf = cbind(df[,c(62:121)], df[,121+index_trait])
  }else{
    df.rf = cbind(df[,c(2:121)], df[,121+index_trait])
  }

  colnames(df.rf)[dim(df.rf)[2]] = "Depressive_Ep"
  df.rf = na.omit(df.rf)
  

  index = sample(c(1:dim(df.rf)[1]), round(dim(df.rf)[1]/3))

  df_train = df.rf[-index,]
  df_test = df.rf[index,]

  
  
  if(feature == "fc"){
   rf_classifier = randomForest(Depressive_Ep ~ FCfeature_1+FCfeature_2+FCfeature_3, data=df_train, ntree=100, mtry=2, importance=TRUE)
    summary(rf_classifier)
    rf.pred = predict(rf_classifier, df_test[,c(1:3)])
  }else if(feature == "sc"){
     rf_classifier = randomForest(Depressive_Ep~SCfeature_1+SCfeature_2+SCfeature_3, data = df_train, ntree=100, mtry=2, importance=TRUE)
    summary(rf_classifier)
    rf.pred = predict(rf_classifier, df_test[,c(1:3)])
  }else{
     rf_classifier = randomForest(Depressive_Ep~FCfeature_1+FCfeature_2+FCfeature_3+SCfeature_1+SCfeature_2+SCfeature_3, data = df_train, ntree=100,  mtry=2,importance=TRUE)
    summary(rf_classifier)
    rf.pred = predict(rf_classifier, df_test[,c(1:3, 61:63)])
  }

  
   
    mse = mean((rf.pred - df_test$Depressive_Ep)^2)
    
    return(list(mod = rf_classifier, mse = mse))
  
    
   
}
```
```{r}
rf.fit(131, feature = "all")
```
```{r}
rf.fit(131, feature = "sc")
```
```{r}
rf.fit(131, feature = "fc")
```

```{r}
summary(df[,121+131])
unique(df[,121+131])
```

```{r}
dt.fit = function(index_trait, feature = "all"){
  if(feature == "fc"){ 
    df.rf = cbind(df[,c(2:61)], df[,121+index_trait])
  }else if(feature == "sc"){
    df.rf = cbind(df[,c(62:121)], df[,121+index_trait])
  }else{
    df.rf = cbind(df[,c(2:121)], df[,121+index_trait])
  }

  colnames(df.rf)[dim(df.rf)[2]] = "Depressive_Ep"
  df.rf = na.omit(df.rf)
  

  index = sample(c(1:dim(df.rf)[1]), round(dim(df.rf)[1]/3))

  df_train = df.rf[-index,]
  df_test = df.rf[index,]

  
  if(feature == "fc"){
   #rt_classifier = randomForest(Depressive_Ep ~ FCfeature_1+FCfeature_2+FCfeature_3, data=df_train, ntree=100, mtry=2, importance=TRUE)
    decision_tree=rpart(
  Depressive_Ep ~ FCfeature_1+FCfeature_2+FCfeature_3, 
  data = df_train,method="class")
    summary( decision_tree)
    dt.pred = predict(decision_tree, df_test[,c(1:3)])
  }else if(feature == "sc"){
     decision_tree = rpart(as.factor(Depressive_Ep)~SCfeature_1+SCfeature_2+SCfeature_3, data = df_train, method="class")
    summary(rf_classifier)
   dt.pred = predict(decision_tree, df_test[,c(1:3)])
  }else{
     decision_tree = randomForest(as.factor(Depressive_Ep)~FCfeature_1+FCfeature_2+FCfeature_3+SCfeature_1+SCfeature_2+SCfeature_3, data = df_train, method="class")
    summary(decision_tree)
    dt.pred = predict(decision_tree, df_test[,c(1:3, 61:63)])
  }
   

  
   
    accuracy = sum((dt.pred==df_test$Depressive_Ep))/length(dt.pred)
    recall=
    
    return(list(mod = decision_tree,accuracy=accuracy))
  
    
   
}
```

```{r}
dt.fit(130, feature = "all")
```



